(()=>{"use strict";var e={265(e,t,n){var o,a=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,a)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=o(e),r=0;r<n.length;r++)"default"!==n[r]&&a(t,e,n[r]);return i(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.activate=function(e){const t=l.commands.registerCommand("cat.explainCode",async()=>{const t=l.window.activeTextEditor;if(!t)return;const n=t.selection,o=t.document.getText(n),a=t.document.languageId;o?(function(e,t){u.push({code:e,languageId:t,timestamp:Date.now()})}(o,a),async function(e){if(p)return;p=!0;const t=u.length;let n=0;for(;u.length>0;){const o=h();if(!o)break;n++;const a=t>1?`Generating explanation ${n}/${t}...`:"Generating Visual Explanation...";await l.window.withProgress({location:l.ProgressLocation.Notification,title:a,cancellable:!1},async()=>{const t=await w(o);d?(d.reveal(l.ViewColumn.Active),d.webview.postMessage({type:"newExplanation",content:t,language:o.languageId})):f(e,t,o.languageId)})}p=!1}(e)):l.window.showInformationMessage("Please select some code first!")});e.subscriptions.push(t)},t.deactivate=function(){};const s=r(n(928)),c=r(n(896)),l=r(n(398));let d,u=[],p=!1;function h(){return u.shift()}async function w(e){try{const t=(await l.lm.selectChatModels({family:"gpt-4"}))[0]||(await l.lm.selectChatModels({}))[0];if(!t)return"No model available.";const n=[l.LanguageModelChatMessage.User(`Explain this code step-by-step for a beginner. \n                Use Markdown. Each step should have one code block and one explanation.\n                make sure there are no more codeblocks than explanations and no more explanations than codeblocks.\n                The explanation should be concise and directly related to the code block.\n                the explanations should never contain any bold or italic text, they should be straightforward and to the point and have no whitespace between them.\n                The code should be broken down into logical sections, each with its own explanation.\n                Do not include any additional commentary or information beyond the code and its explanation. \n                Format: \n                ### Title\n                \`\`\`language\n                code\n                \`\`\`\n                Explanation text here.\n                \n                Code:\n                ${e.code}`)],o=await t.sendRequest(n);let a="";for await(const e of o.text)a+=e;return a}catch(e){return console.error(e),"### Error\n```javascript\n// Error generating explanation\n```\nCould not connect to AI."}}function f(e,t,n){d=l.window.createWebviewPanel("codeExplanation","Code Explanation Slides",l.ViewColumn.Active,{enableScripts:!0,retainContextWhenHidden:!0,localResourceRoots:[l.Uri.joinPath(e.extensionUri,"webview","dist")]});const o=s.join(e.extensionUri.fsPath,"webview","dist","index.html");let a=c.readFileSync(o,"utf-8");a=a.replace(/src="\/assets\/([^"]+)"/g,(t,n)=>`src="${d.webview.asWebviewUri(l.Uri.joinPath(e.extensionUri,"webview","dist","assets",n))}"`),console.log(n),a=a.replace("</body>",`<script>window.markdownContent = ${JSON.stringify(t)}; window.detectedLanguage = ${JSON.stringify(n)};<\/script></body>`),d.webview.html=a,d.onDidDispose(()=>{d=void 0},null,e.subscriptions)}},398(e){e.exports=require("vscode")},896(e){e.exports=require("fs")},928(e){e.exports=require("path")}},t={},n=function n(o){var a=t[o];if(void 0!==a)return a.exports;var i=t[o]={exports:{}};return e[o].call(i.exports,i,i.exports,n),i.exports}(265);module.exports=n})();