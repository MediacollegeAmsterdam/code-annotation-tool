{"version":3,"file":"extension.js","mappings":"k3BA4EA,oBAAyBA,GACrB,MAAMC,EAAaC,EAAOC,SAASC,gBAAgB,kBAAmBC,UAClE,MAAMC,EAASJ,EAAOK,OAAOC,iBAC7B,IAAKF,EAAQ,OAEb,MAAMG,EAAYH,EAAOG,UACnBC,EAAeJ,EAAOK,SAASC,QAAQH,GACvCI,EAAaP,EAAOK,SAASE,WAE/BH,GAtEZ,SAAwBI,EAAcD,GAClCE,EAAiBC,KAAK,CAClBF,OACAD,aACAI,UAAWC,KAAKC,OAExB,CAkEYC,CAAeV,EAAcG,GA5DzCR,eAA4BL,GAExB,GAAIqB,EACA,OAGJA,GAAoB,EAGpB,MAAMC,EAAmBP,EAAiBQ,OAC1C,IAAIC,EAAiB,EAErB,KAAOT,EAAiBQ,OAAS,GAAG,CAChC,MAAME,EAAUC,IAChB,IAAKD,EAAS,MAEdD,IACA,MAGMG,EAFgBL,EAEQ,EACxB,0BAJkBE,KACFF,OAIhB,yCAEApB,EAAOK,OAAOqB,aAAa,CAC7BC,SAAU3B,EAAO4B,iBAAiBC,aAClCJ,QACAK,aAAa,GACd3B,UACC,MAAM4B,QAAiBC,EAAsBT,GAEzCU,GAEAA,EAAaC,OAAOlC,EAAOmC,WAAWC,QACtCH,EAAaI,QAAQC,YAAY,CAC7BC,KAAM,iBACNC,QAAST,EACTU,SAAUlB,EAAQZ,cAItB+B,EAAuB5C,EAASiC,EAAUR,EAAQZ,aAG9D,CAEAQ,GAAoB,CACxB,CAgBYwB,CAAa7C,IAEbE,EAAOK,OAAOuC,uBAAuB,oCAI7C9C,EAAQ+C,cAAc/B,KAAKf,EAC/B,EA8EA,wBAA8B,EA/K9B,kBACA,YACA,YASA,IAEIkC,EAFApB,EAAyC,GACzCM,GAAoB,EAWxB,SAASK,IACL,OAAOX,EAAiBiC,OAC5B,CA0EA3C,eAAe6B,EAAsBT,GACjC,IACI,MACMwB,SADe/C,EAAOgD,GAAGC,iBAAiB,CAAEC,OAAQ,WACrC,WAAalD,EAAOgD,GAAGC,iBAAiB,CAAC,IAAI,GAElE,IAAKF,EAAO,MAAO,sBAEnB,MAAMI,EAAS,CACXnD,EAAOoD,yBAAyBC,KAC5B,07BAeE9B,EAAQX,SAIZ0C,QAAiBP,EAAMQ,YAAYJ,GACzC,IAAIK,EAAW,GACf,UAAW,MAAMC,KAAYH,EAASI,KAClCF,GAAYC,EAEhB,OAAOD,CACX,CAAE,MAAOG,GAEL,OADAC,QAAQC,MAAMF,GACP,0FACX,CACJ,CAEA,SAASjB,EAAuB5C,EAAkCgE,EAAwBnD,GACtFsB,EAAejC,EAAOK,OAAO0D,mBACzB,kBACA,0BACA/D,EAAOmC,WAAWC,OAClB,CACI4B,eAAe,EACfC,yBAAyB,EACzBC,mBAAoB,CAAClE,EAAOmE,IAAIC,SAAStE,EAAQuE,aAAc,UAAW,WAIlF,MAAMC,EAAWC,EAAKC,KAAK1E,EAAQuE,aAAaI,OAAQ,UAAW,OAAQ,cAC3E,IAAIC,EAAOC,EAAGC,aAAaN,EAAU,SAGrCI,EAAOA,EAAKG,QAAQ,2BAA4B,CAACC,EAAOC,IAI7C,QAHS9C,EAAcI,QAAQ2C,aAClChF,EAAOmE,IAAIC,SAAStE,EAAQuE,aAAc,UAAW,OAAQ,SAAUU,QAI/EnB,QAAQqB,IAAItE,GAEZ+D,EAAOA,EAAKG,QACR,UACA,oCAAoCK,KAAKC,UAAUrB,iCAA8CoB,KAAKC,UAAUxE,wBAGpHsB,EAAaI,QAAQqC,KAAOA,EAE5BzC,EAAamD,aAAa,KACtBnD,OAAeoD,GAChB,KAAMvF,EAAQ+C,cACrB,C,SC7KAyC,EAAOC,QAAUC,QAAQ,S,SCAzBF,EAAOC,QAAUC,QAAQ,K,SCAzBF,EAAOC,QAAUC,QAAQ,O,GCCrBC,EAA2B,CAAC,ECE5BC,EDCJ,SAASC,EAAoBC,GAE5B,IAAIC,EAAeJ,EAAyBG,GAC5C,QAAqBP,IAAjBQ,EACH,OAAOA,EAAaN,QAGrB,IAAID,EAASG,EAAyBG,GAAY,CAGjDL,QAAS,CAAC,GAOX,OAHAO,EAAoBF,GAAUG,KAAKT,EAAOC,QAASD,EAAQA,EAAOC,QAASI,GAGpEL,EAAOC,OACf,CCnB0BI,CAAoB,K","sources":["webpack://cat/./src/extension.ts","webpack://cat/external commonjs \"vscode\"","webpack://cat/external node-commonjs \"fs\"","webpack://cat/external node-commonjs \"path\"","webpack://cat/webpack/bootstrap","webpack://cat/webpack/startup"],"sourcesContent":["import * as path from 'path';\nimport * as fs from 'fs';\nimport * as vscode from 'vscode';\n\n// Queue state for explanation requests\ninterface ExplanationRequest {\n    code: string;\n    languageId: string;\n    timestamp: number;\n}\n\nlet explanationQueue: ExplanationRequest[] = [];\nlet isProcessingQueue = false;\nlet currentPanel: vscode.WebviewPanel | undefined = undefined;\n\nfunction enqueueRequest(code: string, languageId: string): void {\n    explanationQueue.push({\n        code,\n        languageId,\n        timestamp: Date.now()\n    });\n}\n\nfunction dequeueRequest(): ExplanationRequest | undefined {\n    return explanationQueue.shift();\n}\n\nasync function processQueue(context: vscode.ExtensionContext): Promise<void> {\n    // Prevent concurrent processing\n    if (isProcessingQueue) {\n        return;\n    }\n    \n    isProcessingQueue = true;\n    \n    // Capture initial queue size for progress tracking\n    const initialQueueSize = explanationQueue.length;\n    let processedCount = 0;\n    \n    while (explanationQueue.length > 0) {\n        const request = dequeueRequest();\n        if (!request) break;\n        \n        processedCount++;\n        const currentPosition = processedCount;\n        const totalRequests = initialQueueSize;\n        \n        const title = totalRequests > 1 \n            ? `Generating explanation ${currentPosition}/${totalRequests}...`\n            : \"Generating Visual Explanation...\";\n        \n        await vscode.window.withProgress({\n            location: vscode.ProgressLocation.Notification,\n            title,\n            cancellable: false\n        }, async () => {\n            const markdown = await explainCodeInMarkdown(request);\n            \n            if (currentPanel) {\n                // If panel exists, send a message to append a new step\n                currentPanel.reveal(vscode.ViewColumn.Active);\n                currentPanel.webview.postMessage({ \n                    type: 'newExplanation', \n                    content: markdown, \n                    language: request.languageId \n                });\n            } else {\n                // Otherwise, create the panel for the first time\n                showExplanationWebview(context, markdown, request.languageId);\n            }\n        });\n    }\n    \n    isProcessingQueue = false;\n}\n\nexport function activate(context: vscode.ExtensionContext) {\n    const disposable = vscode.commands.registerCommand('cat.explainCode', async () => {\n        const editor = vscode.window.activeTextEditor;\n        if (!editor) return;\n\n        const selection = editor.selection;\n        const selectedText = editor.document.getText(selection);\n        const languageId = editor.document.languageId;\n\n        if (selectedText) {\n            // Enqueue the request with captured context\n            enqueueRequest(selectedText, languageId);\n            \n            // Start processing the queue (no-op if already processing)\n            processQueue(context);\n        } else {\n            vscode.window.showInformationMessage(\"Please select some code first!\");\n        }\n    });\n\n    context.subscriptions.push(disposable);\n}\n\nasync function explainCodeInMarkdown(request: ExplanationRequest): Promise<string> {\n    try {\n        const models = await vscode.lm.selectChatModels({ family: 'gpt-4' }); \n        const model = models[0] || (await vscode.lm.selectChatModels({}))[0];\n\n        if (!model) return \"No model available.\";\n\n        const prompt = [\n            vscode.LanguageModelChatMessage.User(\n                `Explain this code step-by-step for a beginner. \n                Use Markdown. Each step should have one code block and one explanation.\n                make sure there are no more codeblocks than explanations and no more explanations than codeblocks.\n                The explanation should be concise and directly related to the code block.\n                the explanations should never contain any bold or italic text, they should be straightforward and to the point and have no whitespace between them.\n                The code should be broken down into logical sections, each with its own explanation.\n                Do not include any additional commentary or information beyond the code and its explanation. \n                Format: \n                ### Title\n                \\`\\`\\`language\n                code\n                \\`\\`\\`\n                Explanation text here.\n                \n                Code:\n                ${request.code}`\n            )\n        ];\n\n        const response = await model.sendRequest(prompt);\n        let fullText = '';\n        for await (const fragment of response.text) {\n            fullText += fragment;\n        }\n        return fullText;\n    } catch (err) {\n        console.error(err);\n        return \"### Error\\n```javascript\\n// Error generating explanation\\n```\\nCould not connect to AI.\";\n    }\n}\n\nfunction showExplanationWebview(context: vscode.ExtensionContext, initialContent: string, languageId: string) {\n    currentPanel = vscode.window.createWebviewPanel(\n        'codeExplanation',\n        'Code Explanation Slides',\n        vscode.ViewColumn.Active,\n        {\n            enableScripts: true,\n            retainContextWhenHidden: true,\n            localResourceRoots: [vscode.Uri.joinPath(context.extensionUri, 'webview', 'dist')]\n        }\n    );\n\n    const htmlPath = path.join(context.extensionUri.fsPath, 'webview', 'dist', 'index.html');\n    let html = fs.readFileSync(htmlPath, 'utf-8');\n\n    // Fix asset paths\n    html = html.replace(/src=\"\\/assets\\/([^\"]+)\"/g, (match, filename) => {\n        const fileUri = currentPanel!.webview.asWebviewUri(\n            vscode.Uri.joinPath(context.extensionUri, 'webview', 'dist', 'assets', filename)\n        );\n        return `src=\"${fileUri}\"`;\n    });\n    console.log(languageId);\n    // Inject Initial Data\n    html = html.replace(\n        '</body>',\n        `<script>window.markdownContent = ${JSON.stringify(initialContent)}; window.detectedLanguage = ${JSON.stringify(languageId)};</script></body>`\n    );\n\n    currentPanel.webview.html = html;\n\n    currentPanel.onDidDispose(() => {\n        currentPanel = undefined;\n    }, null, context.subscriptions);\n}\n\nexport function deactivate() {}","module.exports = require(\"vscode\");","module.exports = require(\"fs\");","module.exports = require(\"path\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(265);\n"],"names":["context","disposable","vscode","commands","registerCommand","async","editor","window","activeTextEditor","selection","selectedText","document","getText","languageId","code","explanationQueue","push","timestamp","Date","now","enqueueRequest","isProcessingQueue","initialQueueSize","length","processedCount","request","dequeueRequest","title","withProgress","location","ProgressLocation","Notification","cancellable","markdown","explainCodeInMarkdown","currentPanel","reveal","ViewColumn","Active","webview","postMessage","type","content","language","showExplanationWebview","processQueue","showInformationMessage","subscriptions","shift","model","lm","selectChatModels","family","prompt","LanguageModelChatMessage","User","response","sendRequest","fullText","fragment","text","err","console","error","initialContent","createWebviewPanel","enableScripts","retainContextWhenHidden","localResourceRoots","Uri","joinPath","extensionUri","htmlPath","path","join","fsPath","html","fs","readFileSync","replace","match","filename","asWebviewUri","log","JSON","stringify","onDidDispose","undefined","module","exports","require","__webpack_module_cache__","__webpack_exports__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","call"],"sourceRoot":""}