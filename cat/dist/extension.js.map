{"version":3,"file":"extension.js","mappings":"k3BAMA,oBAAyBA,GACrB,MAAMC,EAAaC,EAAOC,SAASC,gBAAgB,kBAAmBC,UAClE,MAAMC,EAASJ,EAAOK,OAAOC,iBAC7B,IAAKF,EAAQ,OAEb,MAAMG,EAAYH,EAAOG,UACnBC,EAAeJ,EAAOK,SAASC,QAAQH,GAEzCC,QACMR,EAAOK,OAAOM,aAAa,CAC7BC,SAAUZ,EAAOa,iBAAiBC,aAClCC,MAAO,mCACPC,aAAa,GACdb,UACC,MAAMc,QAmBtBd,eAAqCe,GACjC,IACI,MACMC,SADenB,EAAOoB,GAAGC,iBAAiB,CAAEC,OAAQ,WACrC,WAAatB,EAAOoB,GAAGC,iBAAiB,CAAC,IAAI,GAElE,IAAKF,EAAO,MAAO,sBAEnB,MAAMI,EAAS,CACXvB,EAAOwB,yBAAyBC,KAC5B,iXAUEP,MAIJQ,QAAiBP,EAAMQ,YAAYJ,GACzC,IAAIK,EAAW,GACf,UAAW,MAAMC,KAAYH,EAASI,KAClCF,GAAYC,EAEhB,OAAOD,CACX,CAAE,MAAOG,GAEL,OADAC,QAAQC,MAAMF,GACP,0FACX,CACJ,CApDuCG,CAAsB1B,GAEzC2B,GAEAA,EAAaC,OAAOpC,EAAOqC,WAAWC,QACtCH,EAAaI,QAAQC,YAAY,CAAEC,KAAM,iBAAkBC,QAASzB,KAiDxF,SAAgCnB,EAAkC6C,GAC9DR,EAAenC,EAAOK,OAAOuC,mBACzB,kBACA,0BACA5C,EAAOqC,WAAWQ,OAClB,CACIC,eAAe,EACfC,yBAAyB,EACzBC,mBAAoB,CAAChD,EAAOiD,IAAIC,SAASpD,EAAQqD,aAAc,UAAW,WAIlF,MAAMC,EAAWC,EAAKC,KAAKxD,EAAQqD,aAAaI,OAAQ,UAAW,OAAQ,cAC3E,IAAIC,EAAOC,EAAGC,aAAaN,EAAU,SAGrCI,EAAOA,EAAKG,QAAQ,2BAA4B,CAACC,EAAOC,IAI7C,QAHS1B,EAAcI,QAAQuB,aAClC9D,EAAOiD,IAAIC,SAASpD,EAAQqD,aAAc,UAAW,OAAQ,SAAUU,QAM/EL,EAAOA,EAAKG,QACR,UACA,oCAAoCI,KAAKC,UAAUrB,wBAGvDR,EAAaI,QAAQiB,KAAOA,EAE5BrB,EAAa8B,aAAa,KACtB9B,OAAe+B,GAChB,KAAMpE,EAAQqE,cACrB,CAhFoBC,CAAuBtE,EAASmB,KAIxCjB,EAAOK,OAAOgE,uBAAuB,oCAI7CvE,EAAQqE,cAAcG,KAAKvE,EAC/B,EAyEA,wBAA8B,EA9G9B,kBACA,YACA,YAEA,IAAIoC,C,SCJJoC,EAAOC,QAAUC,QAAQ,S,SCAzBF,EAAOC,QAAUC,QAAQ,K,SCAzBF,EAAOC,QAAUC,QAAQ,O,GCCrBC,EAA2B,CAAC,ECE5BC,EDCJ,SAASC,EAAoBC,GAE5B,IAAIC,EAAeJ,EAAyBG,GAC5C,QAAqBX,IAAjBY,EACH,OAAOA,EAAaN,QAGrB,IAAID,EAASG,EAAyBG,GAAY,CAGjDL,QAAS,CAAC,GAOX,OAHAO,EAAoBF,GAAUG,KAAKT,EAAOC,QAASD,EAAQA,EAAOC,QAASI,GAGpEL,EAAOC,OACf,CCnB0BI,CAAoB,K","sources":["webpack://cat/./src/extension.ts","webpack://cat/external commonjs \"vscode\"","webpack://cat/external node-commonjs \"fs\"","webpack://cat/external node-commonjs \"path\"","webpack://cat/webpack/bootstrap","webpack://cat/webpack/startup"],"sourcesContent":["import * as path from 'path';\nimport * as fs from 'fs';\nimport * as vscode from 'vscode';\n\nlet currentPanel: vscode.WebviewPanel | undefined = undefined;\n\nexport function activate(context: vscode.ExtensionContext) {\n    const disposable = vscode.commands.registerCommand('cat.explainCode', async () => {\n        const editor = vscode.window.activeTextEditor;\n        if (!editor) return;\n\n        const selection = editor.selection;\n        const selectedText = editor.document.getText(selection);\n\n        if (selectedText) {\n            await vscode.window.withProgress({\n                location: vscode.ProgressLocation.Notification,\n                title: \"Generating Visual Explanation...\",\n                cancellable: false\n            }, async () => {\n                const markdown = await explainCodeInMarkdown(selectedText);\n                \n                if (currentPanel) {\n                    // If panel exists, send a message to append a new step\n                    currentPanel.reveal(vscode.ViewColumn.Active);\n                    currentPanel.webview.postMessage({ type: 'newExplanation', content: markdown });\n                } else {\n                    // Otherwise, create the panel for the first time\n                    showExplanationWebview(context, markdown);\n                }\n            });\n        } else {\n            vscode.window.showInformationMessage(\"Please select some code first!\");\n        }\n    });\n\n    context.subscriptions.push(disposable);\n}\n\nasync function explainCodeInMarkdown(code: string): Promise<string> {\n    try {\n        const models = await vscode.lm.selectChatModels({ family: 'gpt-4' }); \n        const model = models[0] || (await vscode.lm.selectChatModels({}))[0];\n\n        if (!model) return \"No model available.\";\n\n        const prompt = [\n            vscode.LanguageModelChatMessage.User(\n                `Explain this code step-by-step for a beginner. \n                Use Markdown. Each step should have one code block and one explanation.\n                Format: \n                ### Title\n                \\`\\`\\`language\n                code\n                \\`\\`\\`\n                Explanation text here.\n                \n                Code:\n                ${code}`\n            )\n        ];\n\n        const response = await model.sendRequest(prompt);\n        let fullText = '';\n        for await (const fragment of response.text) {\n            fullText += fragment;\n        }\n        return fullText;\n    } catch (err) {\n        console.error(err);\n        return \"### Error\\n```javascript\\n// Error generating explanation\\n```\\nCould not connect to AI.\";\n    }\n}\n\nfunction showExplanationWebview(context: vscode.ExtensionContext, initialContent: string) {\n    currentPanel = vscode.window.createWebviewPanel(\n        'codeExplanation',\n        'Code Explanation Slides',\n        vscode.ViewColumn.Beside,\n        {\n            enableScripts: true,\n            retainContextWhenHidden: true,\n            localResourceRoots: [vscode.Uri.joinPath(context.extensionUri, 'webview', 'dist')]\n        }\n    );\n\n    const htmlPath = path.join(context.extensionUri.fsPath, 'webview', 'dist', 'index.html');\n    let html = fs.readFileSync(htmlPath, 'utf-8');\n\n    // Fix asset paths\n    html = html.replace(/src=\"\\/assets\\/([^\"]+)\"/g, (match, filename) => {\n        const fileUri = currentPanel!.webview.asWebviewUri(\n            vscode.Uri.joinPath(context.extensionUri, 'webview', 'dist', 'assets', filename)\n        );\n        return `src=\"${fileUri}\"`;\n    });\n\n    // Inject Initial Data\n    html = html.replace(\n        '</body>',\n        `<script>window.markdownContent = ${JSON.stringify(initialContent)};</script></body>`\n    );\n\n    currentPanel.webview.html = html;\n\n    currentPanel.onDidDispose(() => {\n        currentPanel = undefined;\n    }, null, context.subscriptions);\n}\n\nexport function deactivate() {}","module.exports = require(\"vscode\");","module.exports = require(\"fs\");","module.exports = require(\"path\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(265);\n"],"names":["context","disposable","vscode","commands","registerCommand","async","editor","window","activeTextEditor","selection","selectedText","document","getText","withProgress","location","ProgressLocation","Notification","title","cancellable","markdown","code","model","lm","selectChatModels","family","prompt","LanguageModelChatMessage","User","response","sendRequest","fullText","fragment","text","err","console","error","explainCodeInMarkdown","currentPanel","reveal","ViewColumn","Active","webview","postMessage","type","content","initialContent","createWebviewPanel","Beside","enableScripts","retainContextWhenHidden","localResourceRoots","Uri","joinPath","extensionUri","htmlPath","path","join","fsPath","html","fs","readFileSync","replace","match","filename","asWebviewUri","JSON","stringify","onDidDispose","undefined","subscriptions","showExplanationWebview","showInformationMessage","push","module","exports","require","__webpack_module_cache__","__webpack_exports__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","call"],"sourceRoot":""}